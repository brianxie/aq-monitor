(this["webpackJsonpaq-monitor"]=this["webpackJsonpaq-monitor"]||[]).push([[0],{10:function(t,e,n){t.exports=n(18)},15:function(t,e,n){},18:function(t,e,n){"use strict";n.r(e);var r=n(2),i=n(3),a=n(5),s=n(4),o=n(0),u=n.n(o),l=n(6),c=n.n(l),m=n(20),h=function(t){Object(a.a)(n,t);var e=Object(s.a)(n);function n(){return Object(r.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){var t=this;return u.a.createElement("button",{className:"btn btn-outline-dark btn-sm",type:"button",onClick:function(){return t.props.handleClick()}},this.props.text)}}]),n}(u.a.Component),d=n(1),f="realtime",p="ten_minutes",v="thirty_minutes",g="one_hour",y="six_hours",b="one_day",k="latitude",S="longitude",E=function(){function t(e,n){Object(r.a)(this,t),this.timeData=e,this.positionData=n}return Object(i.a)(t,[{key:"getRealtimeConcentration",value:function(){return this.timeData[f]}},{key:"getLatitude",value:function(){return this.positionData[k]}},{key:"getLongitude",value:function(){return this.positionData[S]}}]),t}(),j="success",O="failure",R="pending",M="tag",w="value",C="err",N=function(t){var e;return e={},Object(d.a)(e,M,j),Object(d.a)(e,w,t),e},P=function(t){var e;return e={},Object(d.a)(e,M,O),Object(d.a)(e,C,t),e},T=function(){return Object(d.a)({},M,R)};function A(t){return u.a.createElement("div",{className:"container"},t)}var B=function(t){Object(a.a)(n,t);var e=Object(s.a)(n);function n(){return Object(r.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){return u.a.createElement("div",{className:"card border-secondary PositionComponent"},this.renderCurrentPositionElement(),this.renderButton())}},{key:"renderButton",value:function(){var t=this;return u.a.createElement("div",{className:"container"},u.a.createElement(h,{text:"Refresh location",handleClick:function(){return t.props.updateFn()}}))}},{key:"renderCurrentPositionElement",value:function(){var t=this.props.positionResult;if(null==t)return A("Position unknown");var e=t[M];switch(e){case j:return A(this.parsePositionValue(t[w]));case O:return A("Error: "+t[C]);case R:return A("Fetching position...");default:throw new Error("Unrecognized tag: "+e.toString())}}},{key:"parsePositionValue",value:function(t){return u.a.createElement("ul",{className:"list-group list-group-flush"},u.a.createElement("li",{className:"list-group-item"},"Latitude: ",t[k].toString()),u.a.createElement("li",{className:"list-group-item"},"Longitude: ",t[S].toString()))}}]),n}(u.a.Component),I=Math.PI/180;function F(t){return Math.pow(Math.sin(t/2),2)}function D(t,e){var n=I*t.positionData[k],r=I*t.positionData[S],i=I*e[k],a=I*e[S],s=F(n-i),o=F(r-a),u=s+Math.cos(i)*Math.cos(n)*o;return 12742*Math.asin(Math.sqrt(u))}var x=function(t){Object(a.a)(n,t);var e=Object(s.a)(n);function n(){return Object(r.a)(this,n),e.apply(this,arguments)}return Object(i.a)(n,[{key:"render",value:function(){return u.a.createElement("div",{className:"card border-secondary SensorsComponent"},this.getClosestSensorsElements(6),this.renderButton())}},{key:"renderButton",value:function(){var t=this;return u.a.createElement("div",{className:"container"},u.a.createElement(h,{text:"Refresh sensor data",handleClick:function(){return t.props.updateFn()}}))}},{key:"getClosestSensorsElements",value:function(t){var e=this,n=this.props.positionResult,r=this.props.sensorModelsResult;if(null==n||null==r)return A("No sensor data");var i=n[M],a=r[M];if(i===O&&a===O)return A("Error: "+n[C]+" | "+r[C]);if(i===O||a===O)return A("Error: "+(i===O?n[C]:r[C]));if(i===R||a===R)return A("Fetching sensor data...");if(i===j&&a===j){var s=n[w];return r[w].map((function(t){return function(t,e){return{sensorModel:t,distance:D(t,e)}}(t,s)})).sort((function(t,e){return t.distance-e.distance})).slice(0,t).map((function(t){return e.computeAndFormatSensor(t)}))}throw new Error("ResponseState could not be handled: "+i.toString()+" | "+a.toString())}},{key:"computeAndFormatSensor",value:function(t){var e=function(t){var e,n,r,i;if(t<=12)e=0,n=12,r=0,i=50;else if(t<=35.4)e=12.1,n=35.4,r=51,i=100;else if(t<=55.4)e=35.5,n=55.4,r=101,i=150;else if(t<=150.4)e=55.5,n=150.4,r=151,i=200;else if(t<=250.4)e=150.5,n=250.4,r=201,i=300;else if(t<=350.4)e=250.5,n=350.4,r=301,i=400;else{if(!(t<=500.4))throw new Error("AQI is _literally incapable_ of measuring this concentration");e=350.5,n=500.4,r=401,i=500}return(t-e)*(i-r)/(n-e)+r}(t.sensorModel.getRealtimeConcentration());return u.a.createElement("div",{className:"container Sensor"},u.a.createElement("h2",null,function(t){var e;return e=t<=50?"success":t<=150?"warning":"danger",u.a.createElement("div",{className:"badge badge-"+e},t.toString())}(e.toFixed(0)))," ","(",t.distance.toFixed(2).toString(),"km from you)")}}]),n}(u.a.Component),_="running",L="paused",q=function(){function t(e,n,i,a){Object(r.a)(this,t),this.timerState=e,this.remainingTimeMillis=n,this.defaultTimeMillis=i,this.callback=a}return Object(i.a)(t,[{key:"decrement",value:function(t){if(this.timerState!==_)return this;var e=this.remainingTimeMillis-t;return e<=0?(this.callback(),this.remainingTimeMillis=this.defaultTimeMillis):this.remainingTimeMillis=e,this}},{key:"pause",value:function(){return this.timerState=L,this}},{key:"resume",value:function(){return this.timerState=_,this}},{key:"reset",value:function(){return this.remainingTimeMillis=this.defaultTimeMillis,this}},{key:"togglePauseResumeAndReturn",value:function(){var t=this.timerState;if(t===L)this.timerState=_;else{if(t!==_)throw new Error("Cannot toggle timer in state: "+t);this.timerState=L}return this}},{key:"getState",value:function(){return this.timerState}},{key:"getRemainingTime",value:function(){return Math.floor(this.remainingTimeMillis/1e3)}}]),t}(),G=function(t){Object(a.a)(n,t);var e=Object(s.a)(n);function n(t){var i;return Object(r.a)(this,n),(i=e.call(this,t)).state={timer:null},i}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.setState({timer:new q(_,this.props.pollIntervalMillis,this.props.pollIntervalMillis,(function(){return t.props.callback()}))}),this.timerId=setInterval((function(){return t.setState({timer:t.state.timer.decrement(1e3)})}),1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timerId)}},{key:"render",value:function(){return u.a.createElement("div",{className:"card border-secondary TimerComponent"},this.renderTimer(),this.renderButtonGroup())}},{key:"togglePauseResumeTimer",value:function(){this.state.timer.timerState===_?this.setState({timer:this.state.timer.pause()}):this.state.timer.timerState===L&&this.setState({timer:this.state.timer.resume()})}},{key:"resetTimer",value:function(){this.setState({timer:this.state.timer.reset()})}},{key:"renderTimer",value:function(){var t=this.state.timer,e=null==t?"No timer present":t.getRemainingTime();return u.a.createElement("div",{className:"container"},u.a.createElement("h2",null,u.a.createElement("span",{className:"badge badge-secondary"},e)))}},{key:"renderButtonGroup",value:function(){return u.a.createElement("div",{className:"buttonGroup",role:"group"},this.renderToggleButton(),this.renderResetButton())}},{key:"renderToggleButton",value:function(){var t,e=this;if(null==this.state.timer)t="Pause/Resume";else switch(this.state.timer.timerState){case _:t="Pause";break;case L:t="Resume";break;default:throw new Error("Cannot toggle timer in state: "+this.state.timer.timerState)}return u.a.createElement(h,{text:t,handleClick:function(){return e.togglePauseResumeTimer()}})}},{key:"renderResetButton",value:function(){var t=this;return u.a.createElement(h,{text:"Reset",handleClick:function(){return t.resetTimer()}})}}]),n}(u.a.Component);function J(t,e){var n;return n={},Object(d.a)(n,k,t),Object(d.a)(n,S,e),n}function U(){return fetch("https://www.purpleair.com/json").then((function(t){return function(t){if(!t.ok)throw new Error(t.status);return t}(t)})).then((function(t){return t.json()})).then((function(t){return t.results})).then((function(t){return t.map((function(t){return function(t){try{var e,n=JSON.parse(t.Stats),r=(e={},Object(d.a)(e,f,n.v),Object(d.a)(e,p,n.v1),Object(d.a)(e,v,n.v2),Object(d.a)(e,g,n.v3),Object(d.a)(e,y,n.v4),Object(d.a)(e,b,n.v5),e),i=J(t.Lat,t.Lon);return N(new E(r,i))}catch(a){return P(a)}}(t)}))})).then((function(t){return t.filter((function(t){return t[M]===j}))})).then((function(t){return t.map((function(t){return t[w]}))}))}var W=function(t){Object(a.a)(n,t);var e=Object(s.a)(n);function n(t){var i;return Object(r.a)(this,n),(i=e.call(this,t)).state={sensorModelsResult:null,positionResult:null,timer:null},i}return Object(i.a)(n,[{key:"render",value:function(){var t=this;return u.a.createElement("div",{className:"container Status"},u.a.createElement(x,{sensorModelsResult:this.state.sensorModelsResult,positionResult:this.state.positionResult,updateFn:function(){return t.updateStatusAsync(!1)}}),u.a.createElement(B,{positionResult:this.state.positionResult,updateFn:function(){return t.updatePositionAsync()}}),u.a.createElement(G,{pollIntervalMillis:this.props.pollIntervalMillis,callback:function(){return t.updateStatusAsync(!1)}}))}},{key:"componentDidMount",value:function(){this.updateStatusAsync(!0)}},{key:"componentWillUnmount",value:function(){}},{key:"handlePositionError",value:function(t){var e="Error in fetching position: "+t.message;this.setState({positionResult:P(e)})}},{key:"handleResultError",value:function(t){var e="Error in fetching sensors: "+t.message;this.setState({sensorModelsResult:P(e)})}},{key:"updatePositionAsync",value:function(){var t=this;return this.setState({positionResult:T()}),new Promise((function(t,e){navigator.geolocation.getCurrentPosition(t,e,void 0)})).then((function(t){return J(parseFloat(t.coords.latitude),parseFloat(t.coords.longitude))})).then((function(e){return t.setState({positionResult:N(e)}),e})).catch((function(e){return t.handlePositionError(e)}))}},{key:"updateSensorModelsAsync",value:function(){var t=this;return this.setState({sensorModelsResult:T()}),U().then((function(e){return t.setState({sensorModelsResult:N(e)}),e})).catch((function(e){return t.handleResultError(e)}))}},{key:"updateStatusAsync",value:function(t){var e;console.log("["+new Date+"] updating...");var n=null!=this.state.positionResult&&this.state.positionResult[M]===j;e=!t&&n?Promise.resolve(this.state.positionResult[w]):this.updatePositionAsync();var r=this.updateSensorModelsAsync();Promise.all([e,r]).then((function(t){console.log("["+new Date+"] finished updating."),console.log(t)}))}}]),n}(u.a.Component),Q=(n(15),function(t){Object(a.a)(n,t);var e=Object(s.a)(n);function n(t){var i;return Object(r.a)(this,n),(i=e.call(this,t)).state={statusActive:!1},i}return Object(i.a)(n,[{key:"renderButton",value:function(){var t=this;return u.a.createElement("div",{className:"container"},u.a.createElement(h,{text:"What's my AQI?",handleClick:function(){return t.toggleStatus()}}))}},{key:"toggleStatus",value:function(){this.setState({statusActive:!this.state.statusActive})}},{key:"renderStatusPlaceholder",value:function(t,e){return u.a.createElement(m.a,{in:t,appear:!0,timeout:300,classNames:"StatusTransition"},u.a.createElement("div",{className:"container"},t&&e))}},{key:"renderStatus",value:function(){return u.a.createElement(W,{pollIntervalMillis:12e4})}},{key:"render",value:function(){return u.a.createElement("div",{className:"container"},this.renderButton(),this.renderStatusPlaceholder(this.state.statusActive,this.renderStatus()))}}]),n}(u.a.Component));c.a.render(u.a.createElement(Q,null),document.getElementById("root"))}},[[10,1,2]]]);
//# sourceMappingURL=main.0578f182.chunk.js.map