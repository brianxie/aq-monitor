(this["webpackJsonpaq-monitor"]=this["webpackJsonpaq-monitor"]||[]).push([[0],{10:function(t,e,n){t.exports=n(18)},15:function(t,e,n){},18:function(t,e,n){"use strict";n.r(e);var r=n(2),a=n(3),i=n(5),o=n(4),s=n(0),u=n.n(s),c=n(6),l=n.n(c),h=n(20),m=(n(15),function(t){Object(i.a)(n,t);var e=Object(o.a)(n);function n(){return Object(r.a)(this,n),e.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var t=this;return u.a.createElement("button",{className:"Button",type:"button",class:"btn btn-outline-secondary btn-lg",onClick:function(){return t.props.handleClick()}},"Placeholder text expand/collapse")}}]),n}(u.a.Component)),f=n(1),d="success",v="failure",p="pending",b="tag",E="value",O="err",S=function(t){var e;return e={},Object(f.a)(e,b,d),Object(f.a)(e,E,t),e},g=function(t){var e;return e={},Object(f.a)(e,b,v),Object(f.a)(e,O,t),e},j=function(){return Object(f.a)({},b,p)},y={REALTIME:"realtime",TEN_MINUTES:"ten_minutes",THIRTY_MINUTES:"thirty_minutes",ONE_HOUR:"one_hour",SIX_HOURS:"six_hours",ONE_DAY:"one_day"},T={LATITUDE:"latitude",LONGITUDE:"longitude"},k=function(){function t(e,n){Object(r.a)(this,t),this.timeData=e,this.locationData=n}return Object(a.a)(t,[{key:"toString",value:function(){var t=this;return Object.keys(T).map((function(t){return T[t]})).map((function(e){return e.toString()+": "+t.locationData[e].toString()})).reduce((function(t,e){return t+"\n"+e}))+"\n"+Object.keys(y).map((function(t){return y[t]})).map((function(e){return e.toString()+": "+t.timeData[e].toString()})).reduce((function(t,e){return t+"\n"+e}))}}]),t}(),I=function(t){Object(i.a)(n,t);var e=Object(o.a)(n);function n(){return Object(r.a)(this,n),e.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){return u.a.createElement("div",{className:"PositionComponent",class:"card-body"},this.getPositionString())}},{key:"getPositionString",value:function(){var t=this.props.position;if(null==t)return"Position unknown";var e=t[b];switch(e){case d:return"Postion: "+this.parsePositionValue(t[E]);case v:return"Error: "+t[O];case p:return"Fetching position...";default:throw new Error("Unrecognized tag: "+e.toString())}}},{key:"parsePositionValue",value:function(t){return"Latitude: "+t[T.LATITUDE].toString()+" Longitude: "+t[T.LONGITUDE].toString()}}]),n}(u.a.Component);var M=function(t){Object(i.a)(n,t);var e=Object(o.a)(n);function n(){return Object(r.a)(this,n),e.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){return u.a.createElement("div",{class:"card-body"},this.getSensorsText())}},{key:"getSensorsText",value:function(){var t=this,e=this.props.sensorModels;if(null==e)return"No sensor data";var n=e[b];switch(n){case d:return e[E].map((function(e){return t.getSingleSensorElem(e)}));case v:return"Error: "+e[O];case p:return"Fetching sensor data...";default:throw new Error("Unrecognized tag: "+n.toString())}}},{key:"getSingleSensorElem",value:function(t){return u.a.createElement("div",{class:"card-body"},function(t){var e,n,r,a;if(t<=12)e=0,n=12,r=0,a=50;else if(t<=35.4)e=12.1,n=35.4,r=51,a=100;else if(t<=55.4)e=35.5,n=55.4,r=101,a=150;else if(t<=150.4)e=55.5,n=150.4,r=151,a=200;else if(t<=250.4)e=150.5,n=250.4,r=201,a=300;else if(t<=350.4)e=250.5,n=350.4,r=301,a=400;else{if(!(t<=500.4))throw new Error("AQI is _literally incapable_ of measuring such a large concentration");e=350.5,n=500.4,r=401,a=500}return(t-e)*(a-r)/(n-e)+r}(t.timeData[y.REALTIME]))}}]),n}(u.a.Component),w="running",N="expired",U=function(){function t(e,n){Object(r.a)(this,t),this.timerState=e,this.remainingTimeMillis=n}return Object(a.a)(t,[{key:"toString",value:function(){return"Timer state: "+this.timerState+"\nTime remaining (seconds): "+Math.floor(this.remainingTimeMillis/1e3)}}]),t}(),D=function(t){Object(i.a)(n,t);var e=Object(o.a)(n);function n(t){var a;return Object(r.a)(this,n),(a=e.call(this,t)).state={timer:null},a}return Object(a.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.setState({timer:new U(w,this.props.pollIntervalMillis)}),this.timerId=setInterval((function(){return t.updateTimer(1e3,t.props.pollIntervalMillis)}),1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timerId)}},{key:"render",value:function(){return u.a.createElement("div",{className:"TimerComponent",class:"card-body"},this.renderTimer())}},{key:"updateTimer",value:function(t,e){var n=this.state.timer.remainingTimeMillis-t,r=n<=0?N:this.state.timer.timerState;this.setState({timer:new U(r,n)}),r===N&&(this.props.callback(),this.setState({timer:new U(w,e)}))}},{key:"renderTimer",value:function(){var t=this.state.timer;return null==t?"No timer present":t.toString()}}]),n}(u.a.Component);function L(t,e){var n=t.lat-e[T.LATITUDE],r=t.lon-e[T.LONGITUDE];return Math.sqrt(Math.pow(n,2)+Math.pow(r,2))}function P(t,e){var n;return n={},Object(f.a)(n,T.LATITUDE,t),Object(f.a)(n,T.LONGITUDE,e),n}function _(){return fetch("https://www.purpleair.com/json").then((function(t){return function(t){if(!t.ok)throw new Error(t.status);return t}(t)})).then((function(t){return t.json()})).then((function(t){return t.results})).then((function(t){return t.map((function(t){return e=t,{lat:parseFloat(e.Lat),lon:parseFloat(e.Lon),result:e};var e}))}))}var A=function(t){Object(i.a)(n,t);var e=Object(o.a)(n);function n(t){var a;return Object(r.a)(this,n),(a=e.call(this,t)).state={sensorModels:null,position:null,timer:null},a}return Object(a.a)(n,[{key:"render",value:function(){var t=this;return u.a.createElement("div",{className:"Status",class:"card text-left border-secondary"},u.a.createElement("div",{className:"Catchall",class:"card-body"},"TODO: catchall text"),u.a.createElement("div",{className:"Sensors",class:"card-body"},u.a.createElement(M,{sensorModels:this.state.sensorModels})),u.a.createElement("div",{className:"Position",class:"card-body"},u.a.createElement(I,{position:this.state.position})),u.a.createElement("div",{className:"TimerSection",class:"card-body"},u.a.createElement(D,{pollIntervalMillis:this.props.pollIntervalMillis,callback:function(){return t.updateStatus(!1)}})))}},{key:"componentDidMount",value:function(){this.updateStatus(!0)}},{key:"componentWillUnmount",value:function(){}},{key:"handleResultError",value:function(t){var e="Error in fetching sensors: "+t.message;throw this.setState({sensorModels:g(e)}),new Error(e)}},{key:"handlePositionError",value:function(t){var e="Error in fetching position: "+t.message;throw this.setState({position:g(e)}),new Error(e)}},{key:"updateStatus",value:function(t){var e,n=this;console.log("["+new Date+"] updating..."),this.setState({sensorModels:j()});var r=null!=this.state.position&&this.state.position[b]===d;!t&&r?e=Promise.resolve(this.state.position[E]):(this.setState({position:j()}),e=new Promise((function(t,e){navigator.geolocation.getCurrentPosition(t,e,void 0)})).then((function(t){return P(parseFloat(t.coords.latitude),parseFloat(t.coords.longitude))})).then((function(t){return n.setState({position:S(t)}),t})).catch((function(t){return n.handlePositionError(t)})));var a=_();a=a.catch((function(t){return n.handleResultError(t)})),Promise.all([a,e]).then((function(t){return e=t[0],n=t[1],e.sort((function(t,e){return L(t,n)-L(e,n)})).map((function(t){return t.result}));var e,n})).then((function(t){return t.slice(0,5)})).then((function(t){return t.map((function(t){var e,n=JSON.parse(t.Stats),r=(e={},Object(f.a)(e,y.REALTIME,n.v),Object(f.a)(e,y.TEN_MINUTES,n.v1),Object(f.a)(e,y.THIRTY_MINUTES,n.v2),Object(f.a)(e,y.ONE_HOUR,n.v3),Object(f.a)(e,y.SIX_HOURS,n.v4),Object(f.a)(e,y.ONE_DAY,n.v5),e),a=P(parseFloat(t.Lat),parseFloat(t.Lon));return new k(r,a)}))})).then((function(t){return n.setState({sensorModels:S(t)})})).catch((function(t){return n.setState({sensorModels:g(t.message)})}))}}]),n}(u.a.Component),C=function(t){Object(i.a)(n,t);var e=Object(o.a)(n);function n(t){var a;return Object(r.a)(this,n),(a=e.call(this,t)).state={statusActive:!1},a}return Object(a.a)(n,[{key:"renderButton",value:function(){var t=this;return u.a.createElement("div",{class:"container p-3"},u.a.createElement(m,{handleClick:function(){return t.toggleStatus()}}))}},{key:"toggleStatus",value:function(){this.setState({statusActive:!this.state.statusActive})}},{key:"renderStatusPlaceholder",value:function(t,e){return u.a.createElement(h.a,{in:t,appear:!0,timeout:300,classNames:"StatusTransition"},u.a.createElement("div",null,t&&e))}},{key:"renderStatus",value:function(){return u.a.createElement("div",{class:"container p-3"},u.a.createElement(A,{pollIntervalMillis:3e5}))}},{key:"render",value:function(){return u.a.createElement("div",{className:"Monitor",class:"container m-5"},this.renderButton(),this.renderStatusPlaceholder(this.state.statusActive,this.renderStatus()))}}]),n}(u.a.Component);l.a.render(u.a.createElement(C,null),document.getElementById("root"))}},[[10,1,2]]]);
//# sourceMappingURL=main.fac4c632.chunk.js.map