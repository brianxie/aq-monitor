(this["webpackJsonpaq-monitor"]=this["webpackJsonpaq-monitor"]||[]).push([[0],{10:function(t,e,n){"use strict";n.r(e);var r=n(2),a=n(3),o=n(5),s=n(4),i=n(0),u=n.n(i),c=n(1),l=n.n(c),h=n(18),d=(n(15),function(t){Object(o.a)(n,t);var e=Object(s.a)(n);function n(){return Object(r.a)(this,n),e.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var t=this;return u.a.createElement("button",{className:"Button",type:"button",class:"btn btn-outline-secondary btn-lg",onClick:function(){return t.props.handleClick()}},"Number of times I've been updated: ",this.props.count)}}]),n}(u.a.Component)),p=function(t){Object(o.a)(n,t);var e=Object(s.a)(n);function n(){return Object(r.a)(this,n),e.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){return u.a.createElement("div",{className:"Status",class:"card text-left border-secondary"},u.a.createElement("div",{className:"AQI",class:"card-body"},this.props.aqiText),u.a.createElement("div",{className:"Position",class:"card-body"},"Your position: ",this.props.position))}},{key:"componentDidMount",value:function(){var t=this;this.props.pollFn();this.timerId=setInterval((function(){return t.props.pollFn()}),6e4)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timerId)}}]),n}(u.a.Component),f=function(t){Object(o.a)(n,t);var e=Object(s.a)(n);function n(t){var a;return Object(r.a)(this,n),(a=e.call(this,t)).state={count:0,statusActive:!1,aqiText:"Default AQI text.",position:"Default position."},a}return Object(a.a)(n,[{key:"createTaggedResult",value:function(t){return{lat:parseFloat(t.Lat),lon:parseFloat(t.Lon),result:t}}},{key:"distanceFromPosition",value:function(t,e){var n=t.lat-e.coords.latitude,r=t.lon-e.coords.longitude;return Math.sqrt(Math.pow(n,2)+Math.pow(r,2))}},{key:"getSortedResults",value:function(t,e){var n=this;return t.sort((function(t,r){return n.distanceFromPosition(t,e)-n.distanceFromPosition(r,e)})).map((function(t){return t.result}))}},{key:"handleFilteredResults",value:function(t){return JSON.parse(t[0].Stats).v1}},{key:"checkResponseOk",value:function(t){if(!t.ok)throw new Error(t.status);return t}},{key:"getRawResults",value:function(){var t=this;return fetch("https://www.purpleair.com/json").then((function(e){return t.checkResponseOk(e)})).then((function(t){return t.json()})).then((function(t){return t.results})).then((function(e){return e.map((function(e){return t.createTaggedResult(e)}))}))}},{key:"handleResultError",value:function(t){var e="Error in fetching sensors: "+t.message;throw new Error(e)}},{key:"handlePositionError",value:function(t){var e="Error in fetching position: "+t.message;throw this.setState({position:e}),new Error(e)}},{key:"updateStatusAndButton",value:function(){var t=this;console.log("["+new Date+"] updating..."),this.setState({count:this.state.count+1}),this.setState({aqiText:"Request pending..."}),this.setState({position:"Position pending..."});var e=new Promise((function(t,e){navigator.geolocation.getCurrentPosition(t,e,void 0)})),n=this.getRawResults();e=e.then((function(e){var n=e.coords.latitude.toString()+", "+e.coords.longitude.toString();return t.setState({position:n}),e})).catch((function(e){return t.handlePositionError(e)})),n=n.catch((function(e){return t.handleResultError(e)})),Promise.all([n,e]).then((function(e){return t.getSortedResults(e[0],e[1])})).then((function(e){return t.handleFilteredResults(e)})).then((function(e){return t.setState({aqiText:e})})).catch((function(e){return t.setState({aqiText:e.message})}))}},{key:"renderStatus",value:function(t){return u.a.createElement("div",{class:"container p-3"},u.a.createElement(p,{aqiText:this.state.aqiText,position:this.state.position,pollFn:t}))}},{key:"toggleStatus",value:function(){this.setState({statusActive:!this.state.statusActive})}},{key:"renderButton",value:function(){var t=this;return u.a.createElement("div",{class:"container p-3"},u.a.createElement(d,{count:this.state.count,handleClick:function(){return t.toggleStatus()}}))}},{key:"renderStatusPlaceholder",value:function(t,e){return u.a.createElement(h.a,{in:t,appear:!0,timeout:300,classNames:"StatusTransition"},u.a.createElement("div",null,t&&e))}},{key:"render",value:function(){return u.a.createElement("div",{className:"Monitor",class:"container m-5"},this.renderButton(),this.renderStatusPlaceholder(this.state.statusActive,this.renderStatus(this.updateStatusAndButton.bind(this))))}}]),n}(u.a.Component);l.a.render(u.a.createElement(f,null),document.getElementById("root"))},15:function(t,e,n){},9:function(t,e,n){t.exports=n(10)}},[[9,1,2]]]);
//# sourceMappingURL=main.166aec14.chunk.js.map